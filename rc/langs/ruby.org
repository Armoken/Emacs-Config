#+TITLE: Ruby
#+OPTIONS: toc:nil num:nil ^:nil

Ruby configuration for Emacs

* Prerequisites
  :PROPERTIES:
  :CUSTOM_ID: haskell-prerequisites
  :END:

#+NAME: ruby-prerequisites
#+CAPTION: Prerequisites for ruby packages

| Name    | Archlinux | Gentoo    | Ubuntu | Optional |
|---------+-----------+-----------+--------+----------|
| [[https://rvm.io/][rvm]]     | from site | from site |        | No       |
| [[https://github.com/bbatsov/rubocop][rubocop]] | gem       | gem       | gem    | No       |
| [[https://github.com/pry/pry][pry]]     | gem       | gem       | gem    | No       |
| [[https://github.com/pry/pry-doc][pry-doc]] | gem       | gem       | gem    | No       |

Installation path: rvm -> ruby -> gem install all packages above


* Packages
:PROPERTIES:
:CUSTOM_ID: ruby-packages
:END:

#+NAME: ruby-packages
#+CAPTION: Packages for ruby
| Package  | Description                                                   |
|----------+---------------------------------------------------------------|
| [[https://github.com/senny/rvm.el][rvm]]      | Integrates Emacs with the Ruby Version Manager                |
| [[https://github.com/nonsequitur/inf-ruby][inf-ruby]] | Provides a REPL buffer connected to a Ruby subprocess         |
| [[https://github.com/bbatsov/rubocop-emacs][rubocop]]  | Interface for rubocop                                         |
| [[https://github.com/dgutov/robe][robe]]     | Code navigation, documentation lookup and completion for Ruby |


* Ruby mode
  Ruby mode for Emacs
  #+BEGIN_SRC emacs-lisp
    (use-package ruby-mode

        :mode ("\\.rb\\'"
               "\\.rake\\'"
               "\\.builder\\'"
               "\\.ru\\'"
               "\\.rabl\\'"
               "\\.gemspec\\'"
               "^\\.pryrc\\'"
               "^\\.irbrc\\'"
               "^Rakefile\\'"
               "^Guardfile\\'"
               "^Gemfile\\'"
               "^config.ru\\'")

        :interpreter "ruby"

        :bind ("C-C C-e" . ruby-send-region)

        :init
        (progn

            (setq ruby-indent-level 2
                  ruby-indent-tabs-mode nil)


            (use-package rvm
                :ensure t
                :defer t
                :config
                (rvm-use-default))

            (use-package inf-ruby
                :ensure t
                :defer t)

            (use-package rubocop
                :ensure t
                :commands rubocop-mode
                :diminish rubocop-mode)

            (use-package robe
                :ensure t
                :commands robe-mode
                :bind ("C-M-." . robe-jump)
                :config
                (defadvice inf-ruby-console-auto (before activate-rvm-for-robe activate)
                    (rvm-activate-corresponding-ruby)))

            (defun ruby-hook ()
                (robe-mode)
                (rubocop-mode)
                (flycheck-mode)
                (add-to-list (make-local-variable 'company-backends)
                             '(company-robe company-dabbrev-code company-yasnippet)))

            (add-hook 'ruby-mode-hook 'ruby-hook)))
  #+END_SRC
